<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>CMPUT 402 - tartan</title><link href="https://cmput402.github.io/" rel="alternate"></link><link href="https://cmput402.github.io/feeds/tartan.atom.xml" rel="self"></link><id>https://cmput402.github.io/</id><updated>2024-01-06T00:00:00-07:00</updated><subtitle>Software Quality</subtitle><entry><title>Project: Tartan Smart Home System</title><link href="https://cmput402.github.io/tartan/build.html" rel="alternate"></link><published>2024-01-06T00:00:00-07:00</published><updated>2024-01-06T00:00:00-07:00</updated><author><name>Hazel Victoria Campbell</name></author><id>tag:cmput402.github.io,2024-01-06:/tartan/build.html</id><summary type="html">&lt;p&gt;Tartan System&lt;/p&gt;</summary><content type="html">&lt;hr&gt;
&lt;h3 id="platform-installation-and-configuration"&gt;Platform Installation and Configuration&lt;/h3&gt;
&lt;p&gt;The initial configuration for the Tartan Smart Home System is done via a YAML
file named &lt;em&gt;config.yml&lt;/em&gt;. The configuration file contains the initial settings
needed for the system including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The configuration information for the Hubs connected to the platform.&lt;/li&gt;
&lt;li&gt;The timer for the data historian (see below).&lt;/li&gt;
&lt;li&gt;The configuration settings for database.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The team has prepared docker containers to quickly get the system up and
running, but for understanding how the system actually works, we describe the
technical components and their configuration below.&lt;/p&gt;
&lt;h4 id="dependencies"&gt;Dependencies&lt;/h4&gt;
&lt;p&gt;The platform is written in Java, using Java 11. If OpenJDK is used,
dependencies for javafx may need to be installed additionally (e.g., &lt;code&gt;apt-get
install openjfx&lt;/code&gt; on Ubuntu). Gradle 7.3 is used as a build system and already
included with the gradlew wrapper. Various Java dependencies are automatically
downloaded during the build from the public Maven repository. MySQL 8.0 is used
as database engine. Python 3.7 is used to execute the house simulator/hub.&lt;/p&gt;
&lt;h4 id="installationdownload-links"&gt;Installation/Download links&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Gradle: https://gradle.org/install/&lt;/li&gt;
&lt;li&gt;For the Gradle Wrapper: go to the directory and run &lt;code&gt;gradle wrapper&lt;/code&gt;, then you can start using &lt;code&gt;gradlew&lt;/code&gt;
      e.g., 
      &lt;code&gt;cd smart-home/Platform
      gradle wrapper&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Java (Windows): https://www.oracle.com/ca-en/java/technologies/javase/jdk11-archive-downloads.html&lt;/li&gt;
&lt;li&gt;MySQL (Ubuntu): https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-18-04&lt;/li&gt;
&lt;li&gt;MySQL (Windows): https://downloads.mysql.com/archives/installer/ Change version to 8.0&lt;/li&gt;
&lt;li&gt;Docker (Ubuntu): https://docs.docker.com/engine/install/ubuntu/&lt;/li&gt;
&lt;li&gt;Docker Desktop (Docker for Windows): https://docs.docker.com/docker-for-windows/install/&lt;/li&gt;
&lt;li&gt;Windows Subsytem for Linux (needed for Docker Desktop): https://docs.microsoft.com/en-us/windows/wsl/install-win10#step-4---download-the-linux-kernel-update-package&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="database-configuration"&gt;Database Configuration&lt;/h4&gt;
&lt;p&gt;The underlying database used in the current system is &lt;a href="https://www.mysql.com/"&gt;MySQL&lt;/a&gt;. The &lt;em&gt;config.yml&lt;/em&gt;
file contains the basic settings for this database:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;database&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="c1"&gt;# the name of the JDBC driver to use&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;driverClass&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;com.mysql.cj.jdbc.Driver&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="c1"&gt;# the DB username&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;tartan&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="c1"&gt;# the DB password&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;tartan1234&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="c1"&gt;# the JDBC URL; the database is called TartanHome&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="l l-Scalar l-Scalar-Plain"&gt;jdbc:mysql://localhost/TartanHome?useJDBCCompliantTimezoneShift=true&amp;amp;useLegacyDatetimeCode=false&amp;amp;serverTimezone=UTC&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;# Allow Hibernate to create tables&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;properties&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nt"&gt;hibernate.dialect&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;org.hibernate.dialect.MySQLDialect&lt;/span&gt;

&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="c1"&gt;# leave it to hibernate to update/create the database.&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="c1"&gt;# Warning, this is generally considered a bad setting for production&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nt"&gt;hibernate.hbm2ddl.auto&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;update&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That is, the system expects access to a MySQL database on localhost with a user
named &lt;strong&gt;tartan&lt;/strong&gt; with a password of &lt;strong&gt;tartan1234&lt;/strong&gt; and a database named
&lt;strong&gt;TartanHome&lt;/strong&gt;. You can use the sample SQL script &lt;em&gt;init.sql&lt;/em&gt; found inside the
Database subfolder to create the database and the user. Tables within this
database are automatically created when the system is run. Note that these
credentials are specified in the system YAML configuration file (&lt;em&gt;config.yml&lt;/em&gt;).&lt;/p&gt;
&lt;h4 id="building-the-platform"&gt;Building the Platform&lt;/h4&gt;
&lt;p&gt;The system is currently developed in &lt;code&gt;smart-home&lt;/code&gt; folder. It contains the
Tartan Service Platform code as well as the house simulator (the Hub).&lt;/p&gt;
&lt;p&gt;The current implementation uses Gradle as the build system. You may want to use the
gradle wrapper &lt;strong&gt;gradlew&lt;/strong&gt; available in the relevant folders which will automatically
download and use the correct gradle version. To that end, use &lt;code&gt;./gradlew&lt;/code&gt; in Ubuntu
and macOS, or &lt;code&gt;gradlew.bat&lt;/code&gt; in Windows. You can supply the same parameters to &lt;strong&gt;gradlew&lt;/strong&gt;
as simple &lt;strong&gt;gradle&lt;/strong&gt;, e.g., &lt;code&gt;./gradlew build&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the Platform project (&lt;em&gt;smart-home&lt;/em&gt; directory), executing &lt;code&gt;./gradlew shadowJar&lt;/code&gt;
inside the &lt;em&gt;/Platform&lt;/em&gt; subfolder will create a single &lt;em&gt;tartan-1.0-SNAPSHOT.jar&lt;/em&gt;
file that contains the Platform and all dependencies. This file will be created
inside the &lt;em&gt;/Platform/build/libs&lt;/em&gt; subfolder. The Platform can then be launched
with &lt;code&gt;java -jar build/libs/tartan-1.0-SNAPSHOT.jar &amp;lt;parameters&amp;gt;&lt;/code&gt; (see below for more
details about the parameters).&lt;/p&gt;
&lt;p&gt;Many of these decisions were made for legacy reasons. Your team may change all
of these technical decisions and tooling if preferred.&lt;/p&gt;
&lt;h4 id="running-the-system"&gt;Running the System&lt;/h4&gt;
&lt;p&gt;The system consists of the following components that must be launched:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;One or more House Hubs (the house simulator, inside &lt;em&gt;smart-home/HouseSimulator&lt;/em&gt; subfolder)&lt;/li&gt;
&lt;li&gt;The MySQL database (&lt;em&gt;smart-home/Database&lt;/em&gt; subfolder)&lt;/li&gt;
&lt;li&gt;The Tartan Service Platform (&lt;em&gt;smart-home/Platform&lt;/em&gt; subfolder)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A docker setup is provided with a finished configuration in the smart-home
folder that starts two houses. You can launch it with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;docker-compose&lt;span class="w"&gt; &lt;/span&gt;up&lt;span class="w"&gt; &lt;/span&gt;--build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you want to run this version, note that there is a separate config file,
&lt;em&gt;config.docker.yml&lt;/em&gt;, that is used in this case.&lt;/p&gt;
&lt;p&gt;If you have made changes and want your docker setup to reflect it, run&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="w"&gt; &lt;/span&gt;docker-compose&lt;span class="w"&gt; &lt;/span&gt;down&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;docker-compose&lt;span class="w"&gt; &lt;/span&gt;build&lt;span class="w"&gt; &lt;/span&gt;--no-cache&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;docker-compose&lt;span class="w"&gt; &lt;/span&gt;up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5 id="windows-differences"&gt;Windows differences&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Open Docker Desktop and under "Container / Apps" remember to "Start" the "smart-home" container.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Below are the instructions to launch the components individually without docker.
However, it is recommended to use Docker Compose instead of manually controlling
the start and shutdown of the components.&lt;/p&gt;
&lt;h5 id="the-house-simulator"&gt;The House Simulator&lt;/h5&gt;
&lt;p&gt;The house simulator is a simple Python program that takes two command line
arguments: the host and port to listen for incoming connections. To run the
house simulator simply execute the following command inside &lt;em&gt;/HouseSimulator&lt;/em&gt;
directory (port will need to be changed for each house if simulating multiple
houses):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3&lt;span class="w"&gt; &lt;/span&gt;simple_server.py&lt;span class="w"&gt; &lt;/span&gt;localhost&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5050&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The start a second house, consistent with the default &lt;em&gt;config.yml&lt;/em&gt; configuration,
execute the following command on another command window:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3&lt;span class="w"&gt; &lt;/span&gt;simple_server.py&lt;span class="w"&gt; &lt;/span&gt;localhost&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5051&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5 id="the-historian-database"&gt;The Historian Database&lt;/h5&gt;
&lt;p&gt;You must start the MySQL server to log house history. You have to make sure that
you start the database before you start the platform. MySQL is typically
started via the following command in Ubuntu:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;start&lt;span class="w"&gt; &lt;/span&gt;mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To start the MySQL service in Windows:
Search for "services" in the Windows search bar, then scroll down and start the "MySQL" service.&lt;/p&gt;
&lt;p&gt;If running manually (not using &lt;code&gt;docker-compose&lt;/code&gt;) then you need to create the database and user manually as well. The following example is for a Windows system.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cd C:\Users\UserName\Documents\CMPUT 402\Tartan\smart-home\Database
&amp;quot;C:\ProgramFiles\MySQL\MySQL Server 8.0\bin\mysql.exe&amp;quot; -u root -p 
source init.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5 id="the-tartan-smart-home-service"&gt;The Tartan Smart Home Service&lt;/h5&gt;
&lt;p&gt;This, again, requires MySQL server. The Platform can be run using the following
command (from &lt;em&gt;/Platform&lt;/em&gt; subfolder):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;java&lt;span class="w"&gt; &lt;/span&gt;-jar&lt;span class="w"&gt; &lt;/span&gt;build/libs/tartan-1.0-SNAPSHOT.jar&lt;span class="w"&gt; &lt;/span&gt;server&lt;span class="w"&gt; &lt;/span&gt;config.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It can also be executed with &lt;code&gt;./gradlew run&lt;/code&gt;, which will pass the same
parameters automatically. Note that the platform must be launched after the
database and the house hub/simulator scripts are running.&lt;/p&gt;
&lt;p&gt;This is the standard way to run a &lt;a href="https://www.dropwizard.io/en/stable/getting-started.html"&gt;Dropwizard
application&lt;/a&gt;. The
&lt;code&gt;server&lt;/code&gt; command runs your application as an HTTP server and the YAML file
&lt;em&gt;config.yml&lt;/em&gt; contains the initial configuration settings. If the system is
running correctly, then you should be able to access it by navigating to the
following URL in a web browser:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://localhost:8080/smarthome/state/&amp;lt;housename&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that &lt;strong&gt;mse&lt;/strong&gt; and &lt;strong&gt;cmu&lt;/strong&gt; are the names of the default houses configured in
config.yml. The default username and password for access to the system is also
configured in this file ("admin" and "1234" for &lt;strong&gt;mse&lt;/strong&gt;, "admin" and "5678" for
&lt;strong&gt;cmu&lt;/strong&gt;).&lt;/p&gt;
&lt;h6 id="possible-issues"&gt;Possible issues&lt;/h6&gt;
&lt;p&gt;While trying to run The Platform, you may encounter the following error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate)&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Appending &lt;code&gt;&amp;amp;enabledTLSProtocols=TLSv1.2&lt;/code&gt; to the end of the &lt;code&gt;${database.url}&lt;/code&gt; property in &lt;em&gt;config.yml&lt;/em&gt; will fix the issue (see the &lt;a href="https://stackoverflow.com/a/67918194/9985287"&gt;StackOverflow solution&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;ARM based Mac Issues:&lt;/p&gt;
&lt;p&gt;ARM based macs (M1 or M2) might have issues running MySQL. If that happens, make sure you are running MySQL 8.0 and not any lower version, even when running with Docker.&lt;/p&gt;</content><category term="tartan"></category><category term="project"></category><category term="grading"></category></entry></feed>